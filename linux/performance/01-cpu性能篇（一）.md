## 平均负载

**平均负载概念**

平均负载是指单位时间内，系统处于**可运行状态**和**不可中断状态**的平均进程数，也就是**平均活跃进程数**，它和 CPU 使用率并没有直接关系。

* **可运行状态：**是指正在使用 CPU 或者正在等待 CPU 的进程。用 ps 命令看到的，处于 R 状态（Running 或 Runnable）的进程。

* **不可中断状态**：的进程则是正处于内核态关键流程中的进程，并且这些流程是不可打断的，比如最常见的是等待硬件设备的 I/O 响应，用 ps 命令中看到的 D 状态（Uninterruptible Sleep，也称为 Disk Sleep）的进程。

* **平均活跃进程数**，直观上的理解就是单位时间内的活跃进程数

> 情形一：
>
> prod@QQ-BJ-test-wj01:~$ uptime 
>  09:35:56 up 268 days, 23:13,  2 users,  load average: 0.13, 0.08, 0.02
>
> 情形二：
>
> laoqiu@autumn-Air  ~  uptime
>  9:37  up 2 days, 15:51, 3 users, load averages: 1.18 1.37 1.62
>
> 现象说明：比如当平均负载为 2 时，意味着什么呢？
>
> * 在只有 2 个 CPU 的系统上，意味着所有的 CPU 都刚好被完全占用。
> * 在 4 个 CPU 的系统上，意味着 CPU 有 50% 的空闲。
> * 而在只有 1 个 CPU 的系统中，则意味着有一半的进程竞争不到 CPU。



**平均负载的合理范围**

* 查看cpu内核数：

  > $ grep 'model name' /proc/cpuinfo | wc -l2
  >
  > 2

  当平均负载比 CPU 个数还大的时候，系统已经出现了过载。

* 一般情况下，**当平均负载高于 CPU 数量 70% 的时候**，就应该分析排查负载高的问题了。

**平均负载小结**

平均负载提供了一个快速查看系统整体性能的手段，反映了整体的负载情况。但只看平均负载本身，并不能直接发现到底是哪里出现了瓶颈。所以，在理解平均负载时，也要注意：

* 平均负载高有可能是 CPU 密集型进程导致的；
* 平均负载高并不一定代表 CPU 使用率高，还有可能是 I/O 更繁忙了；
* 当发现负载高的时候，你可以使用 mpstat、pidstat 等工具，辅助分析负载的来源。

